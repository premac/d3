<html>

<head>
    <!--<meta http-equiv="refresh" content="2">-->
    <meta http-equiv='Content-Type' content='text/html; charset=UTF-8' />
    <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>

<style>
    a {
        font: 10px arial bold;
        padding-right: 20px;
        text-decoration: none;
        color: purple;
    }

    svg.chart {
        /*background-color: gray;*/
    }

    .chart rect {
        fill: steelblue;
        stroke: white;
        cursor: pointer;
    }

    .chart text.title {
                font: 14px arial bold;
            }

    .chart text.key {
        font: 10px arial;
        fill: black;
    }

    .chart text.value {
        font: 10px arial bold;
        fill: steelblue;
    }

</style>

<script type="text/javascript" language="javascript">

var data =
        [
            {
                "time_frame":"2013-04-27 00:20",
                "statistic_aggregate":{
                    "total_size":400,
                    "average_response_time":16.666666666666668,
                    "operation_count":16,
                    "write_ratio":0.7,
                    "hit_ratio":0.1333333333333333
                }
            },
            {
                "time_frame":"2013-04-26 23:40",
                "statistic_aggregate":{
                    "total_size":40,
                    "average_response_time":1.666666666666668,
                    "operation_count":2,
                    "write_ratio":0.2,
                    "hit_ratio":0.5333333333333333
                }
            },
            {
                "time_frame":"2013-04-27 00:10",
                "statistic_aggregate":{
                    "total_size":240,
                    "average_response_time":18.666666666666668,
                    "operation_count":12,
                    "write_ratio":0.5,
                    "hit_ratio":0.3333333333333333
                }
            },
            {
                "time_frame":"2013-04-26 06:05",
                "statistic_aggregate":{
                    "total_size":340,
                    "average_response_time":10.666666666666668,
                    "operation_count":212,
                    "write_ratio":0.11,
                    "hit_ratio":0.6333333333333333
                }
            },
            {
                "time_frame":"2013-04-27 01:50",
                "statistic_aggregate":{
                    "total_size":441,
                    "average_response_time":16.666666666666668,
                    "operation_count":12,
                    "write_ratio":0.5,
                    "hit_ratio":0.1433333333333333
                }
            }
        ];

Number.prototype.toFixedDown = function(digits) {
  var n = this - Math.pow(10, -digits)/2;
  n += n / Math.pow(2, 53); // added 1360765523: 17.56.toFixedDown(2) === "17.56"
  return n.toFixed(digits);
}

var w = 20,
    h = 150,
    t = 60,
    b = 100;

function total_size(d) {
    return d.statistic_aggregate.total_size;
}

function average_response_time(d) {
    return d.statistic_aggregate.average_response_time.toFixedDown(1);
}

function operation_count(d) {
    return d.statistic_aggregate.operation_count;
}

function write_ratio(d) {
    return (d.statistic_aggregate.write_ratio * 100).toFixedDown(1);
}

function hit_ratio(d) {
    return (d.statistic_aggregate.hit_ratio * 100).toFixedDown(1);
}

var valueByTimeFrame = total_size;

var keyByTimeFrame = function(d) {
    return d.time_frame;
};

var x = d3.scale.linear()
    .domain([0, 1])
    .rangeRound([0, w]);

var chart;

function title() {
    if (valueByTimeFrame == total_size) return "Total size";
    if (valueByTimeFrame == average_response_time) return "Average Response Time";
    if (valueByTimeFrame == operation_count) return "Operation Count";
    if (valueByTimeFrame == write_ratio) return "Write Ratio";
    if (valueByTimeFrame == hit_ratio) return "Hit Ratio";
    return String(valueByTimeFrame)
}

function draw() {
    var y = d3.scale.linear()
            .domain([0, d3.max(data.map(valueByTimeFrame))])
            .rangeRound([0, h]);

    //d3.select("body").select(".chart1").remove();

    chart = d3.select("body").select("div").append("svg")
            .attr("class", "chart")
            .attr("width", w * data.length - 1)
            .attr("height", h + t + b);

    chart.append("text").attr("class", "title")
            .attr("dy", 10)
            .text(title);

    chart.selectAll("rect")
            .data(data)
            .enter().append("rect")
            .attr("x", function(d, i) { return x(i) - .5; })
            .attr("y", function(d) { return h + t - y(valueByTimeFrame(d)) - .5; })
            .attr("width", w)
            .attr("height", function(d) { return y(valueByTimeFrame(d)); })
            .attr("onclick", function(d) { return "alert('" + valueByTimeFrame(d) + "')"; });

    chart.selectAll(".key")
            .data(data)
            .enter().append("text").attr("class", "key")
            .attr("dx", -4)
            .attr("dy", 13)
            .attr("text-anchor", "end") // text-align: right
            .attr("transform", function(d, i) { return "translate(" + x(i) + " " + (h + t) + ") rotate (-90) "; })
            .text(keyByTimeFrame);

    chart.selectAll(".value")
            .data(data)
            .enter().append("text").attr("class", "value")
            .attr("dx", 6)
            .attr("dy", 13)
            .attr("text-anchor", "begin") // text-align: right
            .attr("transform", function(d, i) { return "translate(" + x(i) + " " + (h + t - y(valueByTimeFrame(d))) + ") rotate (-90) "; })
            .text(valueByTimeFrame);

    chart.append("line")
            .attr("x1", 0)
            .attr("x2", w * data.length)
            .attr("y1", h + t - .5)
            .attr("y2", h + t - .5)
}

window.onload = draw;

function redraw(valueFunction) {
    valueByTimeFrame = valueFunction;

    var y = d3.scale.linear()
            .domain([0, d3.max(data.map(valueByTimeFrame))])
            .rangeRound([0, h]);

    chart.select(".title")
            .text(title);

    chart.selectAll("rect")
            .data(data)
            .transition().duration(500)
            .attr("y", function(d) { return h + t - y(valueByTimeFrame(d)) - .5; })
            .attr("height", function(d) { return y(valueByTimeFrame(d)); });

    chart.selectAll(".value")
            .data(data)
            .transition().duration(500)
            .attr("transform", function(d, i) { return "translate(" + x(i) + " " + (h + t - y(valueByTimeFrame(d))) + ") rotate (-90) "; })
            .text(valueByTimeFrame);
}

   //http://mbostock.github.io/d3/tutorial/bar-2.html
</script>

</head>
<body>

<div class="chart1">
    <a href="#" onclick="draw()">Draw</a>
    <a href="#" onclick="redraw(total_size)">Total size</a>
    <a href="#" onclick="redraw(average_response_time)">Average Response Time</a>
    <a href="#" onclick="redraw(operation_count)">Operation Count</a>
    <a href="#" onclick="redraw(write_ratio)">Write Ratio</a>
    <a href="#" onclick="redraw(hit_ratio)">Hit Ratio</a>
</div>



</body>
</html>
